function [XMol,YMol,ZMol]=ShowGrid3D(Grid,z,colortype,substrate,solvent,show)
if show==1
    figure('WindowStyle', 'docked');
else
    figure('Visible','off');
end
if z==0
    Matrix.Molecules=Grid.Molecules;
    Matrix.Solvent=Grid.Solvent;
else
    Matrix.Molecules=Grid.Molecules(:,:,z);
    Matrix.Solvent=Grid.Solvent(:,:,z);
end
[Nx,Ny,Nz]=size(Matrix.Molecules);
% Find molecules
[XMol,YMol,ZMol]=ind2sub([Nx Ny Nz],find(Matrix.Molecules>0));
NMol=length(XMol);
% Find solvent
[XSol,YSol,ZSol]=ind2sub([Nx Ny Nz],find(Matrix.Solvent==1));
NSol=length(XSol);
% Find substrate
[XSub,YSub,ZSub]=ind2sub([Nx Ny Nz],find(Matrix.Molecules==-1));
NSub=length(XSub);

% Draw substrate cubes
if substrate
    for sub=1:NSub
        voxel([XSub(sub),YSub(sub),ZSub(sub)],[1 1 1],[0.5 0.5 0.5],1);
    end
end
% Draw solvent cubes
if solvent
    for sol=1:NSol
        voxel([XSol(sol),YSol(sol),ZSol(sol)],[1 1 1],'blue',0.05);
    end
end
% Draw molecule cubes
% Color three different types of sides, rgb
VoxelColor1=[{'blue'} {'green'} {'red'};...
    {'green'} {'blue'} {'red'};...
    {'blue'} {'red'} {'green'};...
    {'red'} {'blue'} {'green'};...
    {'green'} {'red'} {'blue'};...
    {'red'} {'green'} {'blue'}];
% Color by rotation state
VoxelColor2=[{'red'} {'green'} {'blue'} {'magenta'} {'cyan'} {'yellow'}];
% Color by size
VoxelColor3=[{[1 0 0]}...
    {[1 0.1 0]}...
    {[1 0.2 0]}...
    {[1 0.3 0]}...
    {[1 0.4 0]}...
    {[1 0.5 0]}...
    {[1 0.6 0]}...
    {[1 0.7 0]}...
    {[1 0.8 0]}...
    {[1 0.9 0]}...
    {[1 1 0]}...
    {[0.95 1 0]}...
    {[0.90 1 0]}...
    {[0.85 1 0]}...
    {[0.80 1 0]}...
    {[0.75 1 0]}...
    {[0.70 1 0]}...
    {[0.65 1 0]}...
    {[0.60 1 0]}...
    {[0.55 1 0]}...
    {[0.50 1 0]}...
    {[0.45 1 0]}...
    {[0.40 1 0]}...
    {[0.35 1 0]}...
    {[0.30 1 0]}...
    {[0.25 1 0]}...
    {[0.20 1 0]}...
    {[0.15 1 0]}...
    {[0.10 1 0]}...
    {[0.05 1 0]}...
    {[0 1 0.000]}...
    {[0 1 0.025]}...
    {[0 1 0.050]}...
    {[0 1 0.075]}...
    {[0 1 0.100]}...
    {[0 1 0.125]}...
    {[0 1 0.150]}...
    {[0 1 0.175]}...
    {[0 1 0.200]}...
    {[0 1 0.225]}...
    {[0 1 0.250]}...
    {[0 1 0.275]}...
    {[0 1 0.300]}...
    {[0 1 0.325]}...
    {[0 1 0.350]}...
    {[0 1 0.375]}...
    {[0 1 0.400]}...
    {[0 1 0.425]}...
    {[0 1 0.450]}...
    {[0 1 0.475]}...
    {[0 1 0.500]}...
    {[0 1 0.525]}...
    {[0 1 0.550]}...
    {[0 1 0.575]}...
    {[0 1 0.600]}...
    {[0 1 0.625]}...
    {[0 1 0.650]}...
    {[0 1 0.675]}...
    {[0 1 0.700]}...
    {[0 1 0.725]}...
    {[0 1 0.750]}...
    {[0 1 0.775]}...
    {[0 1 0.800]}...
    {[0 1 0.825]}...
    {[0 1 0.850]}...
    {[0 1 0.875]}...
    {[0 1 0.900]}...
    {[0 1 0.925]}...
    {[0 1 0.950]}...
    {[0 1 0.975]}...
    {[0 1 1]}...
    {[0 0.98 1]}...
    {[0 0.96 1]}...
    {[0 0.94 1]}...
    {[0 0.92 1]}...
    {[0 0.90 1]}...
    {[0 0.88 1]}...
    {[0 0.86 1]}...
    {[0 0.84 1]}...
    {[0 0.82 1]}...
    {[0 0.80 1]}...
    {[0 0.78 1]}...
    {[0 0.76 1]}...
    {[0 0.74 1]}...
    {[0 0.72 1]}...
    {[0 0.70 1]}...
    {[0 0.68 1]}...
    {[0 0.66 1]}...
    {[0 0.64 1]}...
    {[0 0.62 1]}...
    {[0 0.60 1]}...
    {[0 0.58 1]}...
    {[0 0.56 1]}...
    {[0 0.54 1]}...
    {[0 0.52 1]}...
    {[0 0.50 1]}...
    {[0 0.48 1]}...
    {[0 0.46 1]}...
    {[0 0.44 1]}...
    {[0 0.42 1]}...
    {[0 0.40 1]}...
    {[0 0.38 1]}...
    {[0 0.36 1]}...
    {[0 0.34 1]}...
    {[0 0.32 1]}...
    {[0 0.30 1]}...
    {[0 0.28 1]}...
    {[0 0.26 1]}...
    {[0 0.24 1]}...
    {[0 0.22 1]}...
    {[0 0.20 1]}...
    {[0 0.18 1]}...
    {[0 0.16 1]}...
    {[0 0.14 1]}...
    {[0 0.12 1]}...
    {[0 0.10 1]}...
    {[0 0.08 1]}...
    {[0 0.06 1]}...
    {[0 0.04 1]}...
    {[0 0.02 1]}...
    {[0 0 1]}];
for mol=1:NMol
    %  mol
    %  Matrix(XMol(mol),YMol(mol),ZMol(mol))
    MoleculeIndex=Matrix.Molecules(XMol(mol),YMol(mol),ZMol(mol));
    Rotation=Grid.ListM(MoleculeIndex).Rotation;
    AggNum=Grid.ListM(MoleculeIndex).Agg;
    AggSize=Grid.ListA(AggNum).NMolecules;
    if AggSize>121
        AggSize=121;
    end
    if colortype==1
        voxel1([XMol(mol),YMol(mol),ZMol(mol)],[1 1 1],VoxelColor1(Rotation,:),0.8);
    elseif colortype==2
        voxel2([XMol(mol),YMol(mol),ZMol(mol)],[1 1 1],VoxelColor2{Rotation},0.8);
    else
        voxel2([XMol(mol),YMol(mol),ZMol(mol)],[1 1 1],VoxelColor3{AggSize},0.8);
    end
end


%title(['Time=' num2str(t)]);
%set(gca,'CLim',[0 2]);
ylabel('y');
xlabel('x');
zlabel('z');
daspect([1 1 1]);
return;